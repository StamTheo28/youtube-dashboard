{% extends "html/base.html" %}

{% load static %}


{% block dashboard %}


<div class="meta-container">
    <div class="left-div">
            <img class="profile-picture" src="{{ meta.thumbnail }}" alt="Thumbnail">
    </div>
    <div class="right-div">
        <table>
            <tr>
                <th>Video Title:</th>
                <td>{{ meta.title }}</td>
            </tr>
            <tr>
                <th>Video ID:</th>
                <td>{{ meta.video_id }}</td>
            </tr>
            <tr>
                <th>Channel Name:</th>
                <td>{{ meta.channelTitle }}</td>
            </tr>
            <tr>
                <th>Publish Date:</th>
                <td>{{ meta.publishedAt }}</td>
            </tr>
            <tr>
                <th>Description:</th>
                <td>
                <div class="description">
                    {{ meta.description }}
                </div>
                <span class="read-more">Read More</span>
                </td>
            </tr>
        </table>
    </div>
</div>


    <div class="box-container">

        <div class="box box1">
            <div class="text">
                <h2 class="topic-heading">{{ meta.viewCount }}</h2>
                <h2 class="topic">Views</h2>
            </div>

            <img src=
"https://media.geeksforgeeks.org/wp-content/uploads/20221210184645/Untitled-design-(31).png"
                alt="Views">
        </div>

        <div class="box box2">
            <div class="text">
                <h2 class="topic-heading">{{ meta.likeCount }}</h2>
                <h2 class="topic">Likes</h2>
            </div>

            <img src=
"https://media.geeksforgeeks.org/wp-content/uploads/20221210185030/14.png"
                alt="likes">
        </div>

        <div class="box box3">
            <div class="text">
                <h2 class="topic-heading">{{ meta.commentCount }}</h2>
                <h2 class="topic">Number of Comments</h2>
            </div>

            <img src=
"https://media.geeksforgeeks.org/wp-content/uploads/20221210184645/Untitled-design-(32).png"
                alt="comments">
        </div>

        <div class="box box4">
            <div class="text">
                <h2 class="topic-heading">{{  meta.favoriteCount }}</h2>
                <h2 class="topic">Favorite Count</h2>
            </div>

            <img src=
"https://media.geeksforgeeks.org/wp-content/uploads/20221210185029/13.png" alt="published">
        </div>
    </div>

    <div class="report-container">
        <div class="report-header">
            <h1 class="recent-Articles">Youtube Comments</h1>
            <button class="view">View All</button>
        </div>

        <div class="table-container">
            <table class="responsive-table">
                <thead>
                    <tr>
                        {% for col in columns %}
                            <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in page_obj  %}
                        <tr>
                            <td>{{ row.comment_id }}</td>
                            <td>
                                <div id="description2" class="description">
                                     {{ row.comment }} 
                                </div>
                                <span class="read-more" >Read More</span>
                            </td>
                            <td>{{ row.like_count }}</td>
                            <td>{{ row.reply_count }}</td>
                            <td>
                                {% if row.type == "positive" %}
                                    <span class="label-tag-pos">{{ row.type }}</span>
                                {% elif row.type == "negative" %}
                                    <span class="label-tag-neg">{{ row.type }}</span>
                                {% else %}
                                    <span class="label-tag-neu">{{ row.type }}</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>

                <div class="pagination">
                    <button id="previous-button" disabled>Previous</button>
                    <span class="current-page">{{ page.number }}</span>
                    <button id="next-button" {% if not page.has_next %}disabled{% endif %}>Next</button>
                </div>
            </table>
        </div>
    </div>

    <script>
    var readMoreButtons = document.querySelectorAll('.read-more');

    readMoreButtons.forEach(function(button) {
    button.style.display = 'inline';
    button.addEventListener('click', function() {
        var description = this.previousElementSibling;
        description.classList.toggle('expanded');
        this.textContent = description.classList.contains('expanded') ? 'Read Less' : 'Read More';
    });
    });


    // Pagination method
    $(document).ready(function() {
    var currentPage = 1;

    function loadPage(pageNumber) {
        var url = window.location.href;
        var queryParams = '?page=' + pageNumber;
        var fullUrl = url + queryParams;

        $.ajax({
        url: fullUrl,
        success: function(data) {
            $('#result-container').html($(data).find('#result-container').html());
            currentPage = pageNumber;
            updateButtonStatus();
        },
        error: function(xhr, status, error) {
            // Handle error
        }
        });
    }

    function updateButtonStatus() {
        $('#previous-button').prop('disabled', !$('.pagination-link[data-page="' + (currentPage - 1) + '"]').length);
        $('#next-button').prop('disabled', !$('.pagination-link[data-page="' + (currentPage + 1) + '"]').length);
    }

    // Initial page load
    loadPage(currentPage);

    // Handle pagination click event
    $(document).on('click', '.pagination-link', function(e) {
        e.preventDefault();
        var page = $(this).data('page');
        if (page !== currentPage) {
        loadPage(page);
        }
    });

    // Handle previous button click event
    $(document).on('click', '#previous-button', function(e) {
        e.preventDefault();
        var page = currentPage - 1;
        if (page >= 1 && page !== currentPage) {
        loadPage(page);
        }
    });

    // Handle next button click event
    $(document).on('click', '#next-button', function(e) {
        e.preventDefault();
        var page = currentPage + 1;
        if (page !== currentPage) {
        loadPage(page);
        }
    });
    });


    </script>
{% endblock dashboard %}
